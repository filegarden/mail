#!/bin/busybox sh

# Exit if an error occurs or an unset variable is referenced.
set -euo pipefail

# By default, don't let `acme.sh` create files accessible to anyone but itself.
# Otherwise, for example, the file it saves our Cloudflare API token to has all
# read permissions enabled by default, which is needlessly lenient.
umask 0007

# Create `acme.sh`'s configuration directory as the `acme` user this script runs
# under, so that `acme.sh` will have access to it. Otherwise, it's created as a
# Docker volume automatically, and only the `root` user is given access.
mkdir -p ~/.acme.sh

# Set `acme.sh`'s default certificate authority to Let's Encrypt.
# TODO: Remove `_test`.
acme.sh --set-default-ca --server letsencrypt_test

# Delete this script. It only needs to exist during the Docker image build.
rm "$0"
