#!/bin/bash

# Exit if an error occurs or an unset variable is referenced.
set -euo pipefail

# `dehydrated` runs this after issuing or renewing certificates.
deploy_cert() {
	# Check if our `usr/local/bin/deploy_certs` script is running by
	# checking if the named pipe it creates exists. The first time TLS
	# certificates are issued and this script runs, nothing else is running
	# yet.
	if [[ -e /var/run/deploy_certs ]]; then
		# Open the pipe for writing, informing our `deploy_certs` script
		# that our certificates have updated.
		printf '' > /var/run/deploy_certs
	fi
}

case "$1" in
deploy_cert)
	"$@"
	;;
*)
	~/bin/cf_hook "$@"
	;;
esac
