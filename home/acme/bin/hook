#!/bin/bash

# Exit if an error occurs or an unset variable is referenced.
set -euo pipefail

# `dehydrated` runs this after issuing or renewing certificates.
deploy_cert() {
	# Check if our `usr/local/bin/deploy_certs` script is running yet by
	# checking if the named pipe it creates exists.
	if [[ -e /run/deploy_certs ]]; then
		# Open the pipe for writing, informing our `deploy_certs` script
		# that our certificates have updated.
		printf '' > /run/deploy_certs
	fi
}

case "$1" in
deploy_cert)
	"$@"
	;;
esac

# Also run our Cloudflare hook script.
~/bin/cf_hook "$@"
