#!/bin/busybox sh

# Exit if an error occurs or an unset variable is referenced.
set -euo pipefail

# Check if we might have ACME account information to update. The first time this
# container runs, our account won't exist yet, so it can't be updated.
if [[ -e ~/dehydrated/accounts ]]; then
	# Update our ACME account information, in case the `ACME_ACCOUNT_EMAIL`
	# value from our `.env` file was changed.
	dehydrated --account

	# Delete any registration info backup files generated by the above
	# command.
	rm -f ~/dehydrated/accounts/*/registration_info-*.json
fi

# Run our TLS certificate issuing script.
~/bin/issue
